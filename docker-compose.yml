# Hapus baris 'version' karena sudah obsolete di Docker terbaru
services:
  # SERVICE 1: Versi Browser (WEBJS)
  # Menggunakan Chrome/Puppeteer.
  waha-browser:
    image: devlikeapro/waha:latest
    # BARIS PENTING UNTUK MAC M1/M2/M3:
    # Kita paksa pakai arsitektur AMD64 agar Chrome berjalan lancar via Rosetta
    platform: linux/amd64 
    container_name: waha_browser
    restart: always
    ports:
      - "9000:3000"
    environment:
      - WHATSAPP_DEFAULT_ENGINE=WEBJS
      - WHATSAPP_FILES_LIFETIME=180
      # Tambahan untuk stabilitas di Mac
      - WAHA_PRINT_QR=True 
      - WAHA_DASHBOARD_USERNAME=admin
      - WAHA_DASHBOARD_PASSWORD=12345678
    volumes:
      - ./waha-browser-data:/app/sessions

  # SERVICE 2: Versi Core (NOWEB)
  # Tetap pakai image 'latest', tapi engine kita set ke NOWEB.
  # Ini akan men-disable Chrome di dalamnya, jadi lebih ringan RAM-nya.
  waha-core:
    image: devlikeapro/waha:latest
    # Tetap samakan platform agar tidak error manifest
    platform: linux/amd64
    container_name: waha_core
    restart: always
    ports:
      - "9001:3000"
    environment:
      # Kunci utamanya disini: Engine NOWEB (Baileys)
      - WHATSAPP_DEFAULT_ENGINE=NOWEB
      - WAHA_PRINT_QR=True
      - WAHA_DASHBOARD_USERNAME=admin
      - WAHA_DASHBOARD_PASSWORD=12345678
    volumes:
      - ./waha-core-data:/app/sessions